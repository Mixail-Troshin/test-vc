<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Вход — VC Metrics</title>
  <link rel="stylesheet" href="/styles.css"/>
</head>
<body>
<header class="topbar">
  <div class="container topbar__in">
    <div class="brand"><span class="brand__dot">vc</span> Metrics</div>
    <nav class="nav"><a class="btn link" href="/">На главную</a></nav>
  </div>
</header>

<main class="wrap-auth">
  <div class="hero-bg"></div>
  <div class="spark"></div>

  <section class="card glass auth-card">
    <h2 style="margin-bottom:6px">Вход</h2>
    <p class="muted" style="margin-top:0">Доступ только для приглашённых.</p>
    <form id="loginForm">
      <label class="field">
        <span>E-mail</span>
        <input id="email" type="email" placeholder="admin@local" autocomplete="username" required>
      </label>
      <label class="field">
        <span>Пароль</span>
        <input id="password" type="password" placeholder="••••••••" autocomplete="current-password" required>
      </label>
      <div class="row" style="gap:12px;align-items:center">
        <button id="loginBtn" class="btn primary" type="submit">Войти</button>
        <span id="loginErr" class="error"></span>
      </div>
    </form>
  </section>
</main>

<script>
const form = document.querySelector('#loginForm');
const btn  = document.querySelector('#loginBtn');
const err  = document.querySelector('#loginErr');

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  err.textContent = '';
  btn.disabled = true; btn.textContent = 'Входим…';
  try {
    const email = document.querySelector('#email').value.trim();
    const password = document.querySelector('#password').value;
    const r = await fetch('/api/login', {
      method:'POST', headers:{'Content-Type':'application/json'},
      credentials:'include', body: JSON.stringify({ email, password })
    });
    if (!r.ok) { const j = await r.json().catch(()=>({error:'Ошибка'})); throw new Error(j.error); }
    const q = new URLSearchParams(location.search); const go = q.get('redirect') || '/app';
    location.assign(go);
  } catch (e2) {
    err.textContent = e2.message || 'Ошибка входа';
  } finally {
    btn.disabled = false; btn.textContent = 'Войти';
  }
});
</script>
</body>
</html>
